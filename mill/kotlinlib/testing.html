<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Testing Kotlin Projects :: The Mill Build Tool</title>
    <link rel="prev" href="dependencies.html" />
    <link rel="next" href="linting.html" />
    <meta name="generator" content="Antora 3.1.9" />
    <link rel="stylesheet" href="../../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon" />
  
  </head><body class="article">
  
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />Â The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">Source Code (GitHub)</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>
        <a class="navbar-item" href="https://discord.gg/MNAXQMAr">Chat</a>

            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../javalib/intro.html">Building Java Projects with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/installation-ide.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/module-config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/dependencies.html">Java Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/testing.html">Testing Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/linting.html">Linting Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/publishing.html">Publishing Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/build-examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../javalib/web-examples.html">Java Web Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scalalib/intro.html">Building Scala Projects with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/installation-ide.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/module-config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/dependencies.html">Scala Library Dependencies</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/testing.html">Testing Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/linting.html">Linting Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/publishing.html">Publishing Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/build-examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/web-examples.html">Scala Web Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="intro.html">(Experimental) Kotlin with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="installation-ide.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="builtin-commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="module-config.html">Kotlin Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="dependencies.html">Kotlin Library Dependencies</a>
  </li>

  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="testing.html">Testing Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="linting.html">Linting Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="publishing.html">Publishing Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="build-examples.html">Kotlin Build Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Build Tool Comparisons</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../comparisons/maven.html">Case Study: Mill vs Maven</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../comparisons/gradle.html">Case Study: Mill vs Gradle</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../comparisons/sbt.html">Case Study: Mill vs SBT</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/library-deps.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/out-dir.html">The Output Directory</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/query-syntax.html">Task Query Syntax</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/cross-builds.html">Cross Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/large-builds.html">Structuring Large Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/sandboxing.html">Mill Sandboxing</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/bundled-libraries.html">Bundled Libraries</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/evaluation-model.html">The Mill Evaluation Model</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extending Mill</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/import-ivy.html">import $ivy</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/using-plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../extending/contrib-plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/sonatypecentral.html">Sonatype Central</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/thirdparty-plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/writing-plugins.html">Writing Mill Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/meta-build.html">The Mill Meta-Build</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../reference/design-principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../reference/changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Mill Documentation</a></li>
    <li><a href="intro.html">(Experimental) Kotlin with Mill</a></li>
    <li><a href="testing.html">Testing Kotlin Projects</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.12.0-RC3-5-d0cc6f</button>
  <div class="version-menu">
    <a class="version is-current" href="testing.html">0.12.0-RC3-5-d0cc6f</a>
    <a class="version is-missing" href="../0.11.12/index.html">0.11.12</a>
    <a class="version is-missing" href="../0.11.11/index.html">0.11.11</a>
    <a class="version is-missing" href="../0.11.10/index.html">0.11.10</a>
    <a class="version is-missing" href="../0.11.0-M7/index.html">0.11.0-M7</a>
    <a class="version is-missing" href="../0.10.15/index.html">0.10.15</a>
    <a class="version is-missing" href="../0.10.12/index.html">0.10.12</a>
    <a class="version is-missing" href="../0.10.0/index.html">0.10.0</a>
    <a class="version is-missing" href="../0.9.12/index.html">0.9.12</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/docs/modules/ROOT/pages/kotlinlib/testing.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Testing Kotlin Projects</h1>
<div id="preamble">
<div class="sectionbody">
<script>
gtag('config', 'AW-16649289906');
</script>
<div class="paragraph">
<p>This page will discuss common topics around working with test suites using the Mill build tool</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_defining_unit_test_suites"><a class="anchor" href="#_defining_unit_test_suites"></a>Defining Unit Test Suites</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-RC3/0.12.0-RC3-example-kotlinlib-testing-1-test-suite.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-RC3//example/kotlinlib/testing/1-test-suite">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, kotlinlib._

object foo extends KotlinModule {

  def mainClass = Some(&quot;foo.FooKt&quot;)

  def kotlinVersion = &quot;1.9.24&quot;

  object test extends KotlinTests {
    def testFramework = &quot;com.github.sbt.junit.jupiter.api.JupiterFramework&quot;
    def ivyDeps = Agg(
      ivy&quot;com.github.sbt.junit:jupiter-interface:0.11.4&quot;,
      ivy&quot;io.kotest:kotest-runner-junit5-jvm:5.9.1&quot;,
      ivy&quot;org.mockito.kotlin:mockito-kotlin:5.4.0&quot;
    )

    // This is needed because of the &quot;mockito-kotlin&quot;
    def kotlincOptions = super.kotlincOptions() ++ Seq(&quot;-jvm-target&quot;, &quot;11&quot;)
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This build defines a single module with a test suite, configured to use
&quot;JUnit&quot; + &quot;Kotest&quot; as the testing framework, along with Mockito. Test suites are themselves
<code>KotlinModule</code>s, nested within the enclosing module,
and have all the normal tasks like
<code>foo.test.compile</code> available to run, but with an additional <code>.test</code> task
that runs the tests. You can also run the test suite directly, in which case
it will run the <code>.test</code> task as the default task for that module.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill foo.compile
Compiling 1 ... source...

&gt; mill foo.test.compile
Compiling 1 ... source...

&gt; mill foo.test.test
...foo.FooTests...hello ...
...foo.FooTests...world ...

&gt; mill foo.test # same as above, `.test` is the default task for the `test` module
...foo.FooTests...hello ...
...foo.FooTests...world ...

&gt; mill foo.test.testOnly foo.FooTests # explicitly select the test class you wish to run
...foo.FooTests...hello ...
...foo.FooTests...world ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For convenience, you can also use one of the predefined test frameworks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TestModule.Junit4</code></p>
</li>
<li>
<p><code>TestModule.Junit5</code></p>
</li>
<li>
<p><code>TestModule.TestNg</code></p>
</li>
<li>
<p><code>TestModule.Munit</code></p>
</li>
<li>
<p><code>TestModule.ScalaTest</code></p>
</li>
<li>
<p><code>TestModule.Specs2</code></p>
</li>
<li>
<p><code>TestModule.Utest</code></p>
</li>
<li>
<p><code>TestModule.ZioTest</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object bar extends KotlinModule {

  def mainClass = Some(&quot;bar.BarKt&quot;)

  def kotlinVersion = &quot;1.9.24&quot;

  object test extends KotlinTests with TestModule.Junit5 {
    def ivyDeps = super.ivyDeps() ++ Agg(
      ivy&quot;io.kotest:kotest-runner-junit5-jvm:5.9.1&quot;,
      ivy&quot;org.mockito.kotlin:mockito-kotlin:5.4.0&quot;
    )

    // This is needed because of the &quot;mockito-kotlin&quot;
    def kotlincOptions = super.kotlincOptions() ++ Seq(&quot;-jvm-target&quot;, &quot;11&quot;)
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill bar.test
...bar.BarTests...hello ...
...bar.BarTests...world ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also select multiple test suites in one command using Millâs
<a href="../depth/query-syntax.html" class="xref page">Task Query Syntax</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill __.test
...bar.BarTests...hello ...
...bar.BarTests...world ...
...foo.FooTests...hello ...
...foo.FooTests...world ...
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill provides three ways of running tests</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foo.test.test</code>: runs tests in a subprocess in an empty <code>sandbox/</code> folder.</p>
</li>
<li>
<p><code>foo.test.testCached</code>: runs the tests in an empty <code>sandbox/</code> folder and caches the results
if successful. Also allows multiple test modules to be run in parallel e.g. via <code>mill __.testCached</code></p>
</li>
<li>
<p><code>foo.test.testLocal</code>: runs tests in an isolated classloader as part of the main Mill process.
This can be faster than <code>.test</code>, but is less flexible (e.g. you cannot pass <code>forkEnv</code>)
and more prone to interference (due to sharing the <code>sandbox/</code> folder provided by the
Mill process)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill bar.test.test

&gt; mill bar.test.testCached

&gt; mill bar.test.testLocal</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mill provides three ways of running tests</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foo.test.test</code>: runs tests in a subprocess in an empty <code>sandbox/</code> folder, and
<code>forkArg</code> and <code>forkEnv</code> can be overridden to pass JVM flags &amp; environment variables.</p>
</li>
<li>
<p><code>foo.test.testCached</code>: runs the tests in an empty <code>sandbox/</code> folder and caches the results
if successful. Also allows multiple test modules to be run in parallel e.g. via
<code>mill __.testCached</code>. Again, <code>forkEnv</code> and <code>forkArgs</code> can be configured.</p>
</li>
<li>
<p><code>foo.test.testLocal</code>: runs tests in an isolated classloader as part of the main Mill process.
This can be faster than <code>.test</code>, but is less flexible (e.g. you cannot pass <code>forkEnv</code>)
and more prone to interference (due to sharing the <code>sandbox/</code> folder provided by the
Mill process)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill bar.test.test

&gt; mill bar.test.testCached

&gt; mill bar.test.testLocal</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note that Mill runs tests with the working directory set to an empty <code>sandbox/</code> folder by default</strong>.
Tests can access files from their resource directory via the environment variable
<code>MILL_TEST_RESOURCE_DIR</code> which provides the path to the resource folder, and additional
paths can be provided to test via <code>forkEnv</code>. See
<a href="../javalib/module-config.html#_classpath_and_filesystem_resources" class="xref page">Classpath and Filesystem Resources</a>
for more details.</p>
</div>
<div class="paragraph">
<p>If you want to pass any arguments to the test framework, simply put them after
<code>foo.test</code> in the command line. e.g. <a href="https://github.com/com-lihaoyi/utest">uTest</a>
lets you pass in a selector to decide which test to run, which in Mill would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; kotest_filter_tests='hello' kotest_filter_specs='bar.BarTests' ./mill bar.test
...bar.BarTests...hello ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_dependencies"><a class="anchor" href="#_test_dependencies"></a>Test Dependencies</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>Mill has no <code>test</code>-scoped dependencies!</em></p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You might be used to test-scoped dependencies from other build tools like
Maven, Gradle or sbt. As test modules in Mill are just regular modules,
there is no special need for a dedicated test-scope. You can use <code>ivyDeps</code>
and <code>runIvyDeps</code> to declare dependencies in test modules, and test modules
can use their <code>moduleDeps</code> to also depend on each other</p>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-RC3/0.12.0-RC3-example-kotlinlib-testing-2-test-deps.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-RC3//example/kotlinlib/testing/2-test-deps">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, kotlinlib._

object qux extends KotlinModule {

  def kotlinVersion = &quot;1.9.24&quot;

  def moduleDeps = Seq(baz)

  object test extends KotlinTests with TestModule.Junit5 {
    def moduleDeps = super.moduleDeps ++ Seq(baz.test)
    def ivyDeps = super.ivyDeps() ++ Agg(
      ivy&quot;io.kotest:kotest-runner-junit5-jvm:5.9.1&quot;,
      ivy&quot;com.google.guava:guava:33.3.0-jre&quot;
    )
  }
}

object baz extends KotlinModule {

  def kotlinVersion = &quot;1.9.24&quot;

  object test extends KotlinTests with TestModule.Junit5 {
    def ivyDeps = super.ivyDeps() ++ Agg(
      ivy&quot;io.kotest:kotest-runner-junit5-jvm:5.9.1&quot;,
      ivy&quot;com.google.guava:guava:33.3.0-jre&quot;
    )
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, not only does <code>qux</code> depend on <code>baz</code>, but we also make
<code>qux.test</code> depend on <code>baz.test</code>. That lets <code>qux.test</code> make use of the
<code>BazTestUtils</code> class that <code>baz.test</code> defines, allowing us to re-use this
test helper throughout multiple modules' test suites</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill qux.test
Using BazTestUtils.bazAssertEquals
... qux.QuxTests...simple ...
...

&gt; ./mill baz.test
Using BazTestUtils.bazAssertEquals
... baz.BazTests...simple ...
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_defining_integration_test_suites"><a class="anchor" href="#_defining_integration_test_suites"></a>Defining Integration Test Suites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can also define test suites with different names other than <code>test</code>. For example,
the build below defines a test suite with the name <code>integration</code>, in addition
to that named <code>test</code>.</p>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-RC3/0.12.0-RC3-example-kotlinlib-testing-3-integration-suite.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-RC3//example/kotlinlib/testing/3-integration-suite">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, kotlinlib._
object qux extends KotlinModule {

  def kotlinVersion = &quot;1.9.24&quot;

  object test extends KotlinTests with TestModule.Junit5 {
    def ivyDeps = super.ivyDeps() ++ Agg(
      ivy&quot;io.kotest:kotest-runner-junit5-jvm:5.9.1&quot;
    )
  }
  object integration extends KotlinTests with TestModule.Junit5 {
    def ivyDeps = super.ivyDeps() ++ Agg(
      ivy&quot;io.kotest:kotest-runner-junit5-jvm:5.9.1&quot;
    )
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The integration suite is just another regular test module within the parent KotlinModule
(This example also demonstrates using Junit 5 instead of Junit 4)</p>
</div>
<div class="paragraph">
<p>These two test modules will expect their sources to be in their respective <code>foo/test</code> and
<code>foo/integration</code> folder respectively</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill 'qux.{test,integration}' # run both test suites
...qux.QuxTests...hello...
...qux.QuxTests...world...
...qux.QuxIntegrationTests...helloworld...

&gt; mill __.integration.testCached # run all integration test suites</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_grouping"><a class="anchor" href="#_test_grouping"></a>Test Grouping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Test Grouping is an opt-in feature that allows you to take a single
test module and group the test classes such that each group will
execute in parallel when you call <code>test</code>. Test grouping is enabled
by overriding <code>def testForkGrouping</code>, as shown below:</p>
</div>
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-RC3/0.12.0-RC3-example-kotlinlib-testing-4-test-grouping.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-RC3//example/kotlinlib/testing/4-test-grouping">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, kotlinlib._

object foo extends KotlinModule {

  def mainClass = Some(&quot;foo.FooKt&quot;)

  def kotlinVersion = &quot;1.9.24&quot;

  object test extends KotlinTests {
    def testFramework = &quot;com.github.sbt.junit.jupiter.api.JupiterFramework&quot;
    def ivyDeps = Agg(
      ivy&quot;com.github.sbt.junit:jupiter-interface:0.11.4&quot;,
      ivy&quot;io.kotest:kotest-runner-junit5-jvm:5.9.1&quot;,
      ivy&quot;org.mockito.kotlin:mockito-kotlin:5.4.0&quot;
    )

    def testForkGrouping = discoveredTestClasses().grouped(1).toSeq
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">foo/test/src/foo/HelloTests.kt (<a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-RC3//example/kotlinlib/testing/4-test-grouping/foo/test/src/foo/HelloTests.kt">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package foo

import io.kotest.core.spec.style.FunSpec
import io.kotest.matchers.string.shouldStartWith

class HelloTests : FunSpec({
    test(&quot;hello&quot;) {
        println(&quot;Testing Hello&quot;)
        val result = Foo().hello()
        result shouldStartWith &quot;Hello&quot;
        java.lang.Thread.sleep(1000)
        println(&quot;Testing Hello Completed&quot;)
    }
})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">foo/test/src/foo/WorldTests.kt (<a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-RC3//example/kotlinlib/testing/4-test-grouping/foo/test/src/foo/WorldTests.kt">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package foo

import io.kotest.core.spec.style.FunSpec
import io.kotest.matchers.string.shouldEndWith

class WorldTests : FunSpec({
    test(&quot;world&quot;) {
        println(&quot;Testing World&quot;)
        val result = Foo().hello()
        result shouldEndWith &quot;World&quot;
        java.lang.Thread.sleep(1000)
        println(&quot;Testing World Completed&quot;)
    }
})</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we have one test module <code>foo.test</code>, and two test classes
<code>HelloTests</code> and <code>WorldTests</code>. By default, all test classes in the same
module run sequentially in the same JVM, but with <code>testForkGrouping</code> we can break up the
module and run each test class in parallel in separate JVMs, each with their own
separate <code>sandbox</code> folder and <code>.log</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill foo.test

&gt; find out/foo/test/test.dest
...
out/foo/test/test.dest/foo.HelloTests.log
out/foo/test/test.dest/foo.HelloTests/sandbox
out/foo/test/test.dest/foo.WorldTests.log
out/foo/test/test.dest/foo.WorldTests/sandbox
out/foo/test/test.dest/test-report.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Test grouping allows you to run tests in parallel while keeping things deterministic and
debuggable: parallel test groups will not write over each others files in their
sandbox, and each one will have a separate set of logs that can be easily read
without the others mixed in</p>
</div>
<div class="paragraph">
<p>In this example, <code>def testForkGrouping = discoveredTestClasses().grouped(1).toSeq</code> assigns
each test class to its own group, running in its own JVM. This comes with some overhead
on a per-JVM basis, so if your test classes are numerous and small you may want to assign
multiple test classes per group. You can also configure <code>testForkGrouping</code> to choose which
test classes you want to run together and which to run alone:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If some test classes
are much slower than others, you may want to put the slow test classes each in its own
group to reduce latency, while grouping multiple fast test classes together to reduce the
per-group overhead of spinning up a separate JVM.</p>
</li>
<li>
<p>Some test classes may have global JVM-wide or filesystem side effects that means they
have to run alone, while other test classes may be better-behaved and OK to run in a group</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general, <code>testForkGrouping</code> leaves it up to you how you want to group your tests for
execution, based on the unique constraints of your test suite.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="dependencies.html">Kotlin Library Dependencies</a></span>
  <span class="next"><a href="linting.html">Linting Kotlin Projects</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async="async" src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async="async" src="../../search-index.js"></script>
  
</body></html>