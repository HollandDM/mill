<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Java Build Examples :: The Mill Build Tool</title>
    <link rel="canonical" href="https://mill-build.org/mill/0.11.12/Java_Build_Examples.html" />
    <link rel="prev" href="Java_Module_Config.html" />
    <link rel="next" href="Testing_Java_Projects.html" />
    <meta name="generator" content="Antora 3.1.9" />
    <link rel="stylesheet" href="../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../_/favicon.png" type="image/x-icon" />
  
  </head><body class="article">
  
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../_/logo-white.svg" height="20" />Â The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">Source Code (GitHub)</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>
        <a class="navbar-item" href="https://discord.com/channels/632150470000902164/940067748103487558">Chat</a>

            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Java_Intro_to_Mill.html">Introduction to Mill for Java</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Module_Config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="Java_Build_Examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Testing_Java_Projects.html">Testing Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Web_Examples.html">Java Web Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Case_Study_Mill_vs_Maven.html">Case Study: Mill vs Maven</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Case_Study_Mill_vs_Gradle.html">Case Study: Mill vs Gradle</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Scala_Intro_to_Mill.html">Introduction to Mill for Scala</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Module_Config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Build_Examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Testing_Scala_Projects.html">Testing Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Scala_Web_Examples.html">Scala Web Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Case_Study_Mill_vs_SBT.html">Case Study: Mill vs SBT</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Library_Dependencies.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Out_Dir.html">The Output Directory</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Target_Query_Syntax.html">Target Query Syntax</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Structuring_Large_Builds.html">Structuring Large Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="The_Mill_Evaluation_Model.html">The Mill Evaluation Model</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Mill_Sandboxing.html">Mill Sandboxing</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extending Mill</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Import_File_And_Import_Ivy.html">import $file and import $ivy</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Using_Plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Contrib_Plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/errorprone.html">Mill ErrorProne Plugin</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/sonatypecentral.html">Sonatype Central</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Thirdparty_Plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Writing_Mill_Plugins.html">Writing Mill Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="The_Mill_Meta_Build.html">The Mill Meta-Build</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Mill_Design_Principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Bundled_Libraries.html">Bundled Libraries</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Changelog.html">Changelog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Mill Documentation</span>
    <span class="version">0.12.0-M0-92-9b2840</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="0.11.12/index.html">Mill Documentation</a></div>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">0.12.0-M0-92-9b2840</a>
        </li>
        <li class="version is-latest">
          <a href="0.11.12/index.html">0.11.12</a>
        </li>
        <li class="version">
          <a href="0.11.11/index.html">0.11.11</a>
        </li>
        <li class="version">
          <a href="0.11.10/index.html">0.11.10</a>
        </li>
        <li class="version">
          <a href="0.11.0-M7/index.html">0.11.0-M7</a>
        </li>
        <li class="version">
          <a href="0.10.15/index.html">0.10.15</a>
        </li>
        <li class="version">
          <a href="0.10.12/index.html">0.10.12</a>
        </li>
        <li class="version">
          <a href="0.10.0/index.html">0.10.0</a>
        </li>
        <li class="version">
          <a href="0.9.12/index.html">0.9.12</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="0.11.12/Java_Intro_to_Mill.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Mill Documentation</a></li>
    <li><a href="Java_Intro_to_Mill.html">Introduction to Mill for Java</a></li>
    <li><a href="Java_Build_Examples.html">Java Build Examples</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.12.0-M0-92-9b2840</button>
  <div class="version-menu">
    <a class="version is-current" href="Java_Build_Examples.html">0.12.0-M0-92-9b2840</a>
    <a class="version" href="0.11.12/Java_Build_Examples.html">0.11.12</a>
    <a class="version" href="0.11.11/Java_Build_Examples.html">0.11.11</a>
    <a class="version" href="0.11.10/Java_Build_Examples.html">0.11.10</a>
    <a class="version is-missing" href="0.11.0-M7/index.html">0.11.0-M7</a>
    <a class="version is-missing" href="0.10.15/index.html">0.10.15</a>
    <a class="version is-missing" href="0.10.12/index.html">0.10.12</a>
    <a class="version is-missing" href="0.10.0/index.html">0.10.0</a>
    <a class="version is-missing" href="0.9.12/index.html">0.9.12</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/docs/modules/ROOT/pages/Java_Build_Examples.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Java Build Examples</h1>
<div id="preamble">
<div class="sectionbody">
<script>
gtag('config', 'AW-16649289906');
</script>
<div class="paragraph">
<p>On this page, we will explore the Mill build tool via a series of simple Java
example projects. Each project demonstrates one particular feature of the Mill
build tool, and is also an executable codebase you can download and run. By the
end of this page, you will be familiar with how to configure Mill to work with
realistic Java codebases: cross-building, testing, and publishing them.</p>
</div>
<div class="paragraph">
<p>Many of the APIs covered here are listed in the API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://mill-build.org/api/latest/mill/main/RootModule.html"><code>mill.scalalib.RootModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/TestModule$.html"><code>mill.scalalib.TestModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/PublishModule.html"><code>mill.scalalib.PublishModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/MavenModule.html"><code>mill.scalalib.MavenModule</code></a></p>
</li>
<li>
<p><a href="https://mill-build.org/api/latest/mill/scalalib/JavaModule.html"><code>mill.scalalib.JavaModule</code></a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_common_configuration_overrides"><a class="anchor" href="#_common_configuration_overrides"></a>Common Configuration Overrides</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-builds-1-common-config.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/builds/1-common-config">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object `package` extends RootModule with JavaModule {
  // You can have arbitrary numbers of third-party dependencies
  def ivyDeps = Agg(
    ivy&quot;org.apache.commons:commons-text:1.12.0&quot;
  )

  // Choose a main class to use for `.run` if there are multiple present
  def mainClass: T[Option[String]] = Some(&quot;foo.Foo2&quot;)

  // Add (or replace) source folders for the module to use
  def sources = T.sources{
    super.sources() ++ Seq(PathRef(millSourcePath / &quot;custom-src&quot;))
  }

  // Add (or replace) resource folders for the module to use
  def resources = T.sources{
    super.resources() ++ Seq(PathRef(millSourcePath / &quot;custom-resources&quot;))
  }

  // Generate sources at build time
  def generatedSources: T[Seq[PathRef]] = T {
    for(name &lt;- Seq(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)) os.write(
      T.dest / s&quot;Foo$name.java&quot;,
      s&quot;&quot;&quot;
package foo;
public class Foo$name {
  public static String value = &quot;hello $name&quot;;
}
      &quot;&quot;&quot;.stripMargin
    )

    Seq(PathRef(T.dest))
  }

  // Pass additional JVM flags when `.run` is called or in the executable
  // generated by `.assembly`
  def forkArgs: T[Seq[String]] = Seq(&quot;-Dmy.custom.property=my-prop-value&quot;)

  // Pass additional environmental variables when `.run` is called. Note that
  // this does not apply to running externally via `.assembly
  def forkEnv: T[Map[String, String]] = Map(&quot;MY_CUSTOM_ENV&quot; -&gt; &quot;my-env-value&quot;)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to better understand how the various upstream tasks feed into
a task of interest, such as <code>run</code>, you can visualize their relationships via</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill show visualizePlan run</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/VisualizePlanJava.svg" alt="VisualizePlanJava.svg" />
</div>
</div>
<div class="paragraph">
<p>(right-click open in new tab to see full sized)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_custom_tasks"><a class="anchor" href="#_custom_tasks"></a>Custom Tasks</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-builds-2-custom-tasks.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/builds/2-custom-tasks">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object `package` extends RootModule with JavaModule {
  def ivyDeps = Agg(ivy&quot;net.sourceforge.argparse4j:argparse4j:0.9.0&quot;)

  def generatedSources: T[Seq[PathRef]] = T {
    val prettyIvyDeps = for(ivyDep &lt;- ivyDeps()) yield {
      val org = ivyDep.dep.module.organization.value
      val name = ivyDep.dep.module.name.value
      val version = ivyDep.dep.version
      s&quot;&quot;&quot; &quot;$org:$name:$version&quot; &quot;&quot;&quot;
    }
    val ivyDepsString = prettyIvyDeps.mkString(&quot; + \&quot;\\n\&quot; + \n&quot;)
    os.write(
      T.dest / s&quot;MyDeps.java&quot;,
      s&quot;&quot;&quot;
package foo;
public class MyDeps {
  public static String value =
    $ivyDepsString;
}
      &quot;&quot;&quot;.stripMargin
    )

    Seq(PathRef(T.dest))
  }

  def lineCount: T[Int] = T {
    sources()
      .flatMap(pathRef =&gt; os.walk(pathRef.path))
      .filter(_.ext == &quot;java&quot;)
      .map(os.read.lines(_).size)
      .sum
  }

  def forkArgs: T[Seq[String]] = Seq(s&quot;-Dmy.line.count=${lineCount()}&quot;)

  def printLineCount() = T.command { println(lineCount()) }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill run --text hello
text: hello
MyDeps.value: net.sourceforge.argparse4j:argparse4j:0.9.0
my.line.count: 24

&gt; mill show lineCount
24

&gt; mill printLineCount
24</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overriding_tasks"><a class="anchor" href="#_overriding_tasks"></a>Overriding Tasks</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-builds-3-override-tasks.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/builds/3-override-tasks">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object foo extends JavaModule {

  def sources = T{
    os.write(
      T.dest / &quot;Foo.java&quot;,
      &quot;&quot;&quot;package foo;

public class Foo {
    public static void main(String[] args) {
        System.out.println(&quot;Hello World&quot;);
    }
}
      &quot;&quot;&quot;.stripMargin
    )
    Seq(PathRef(T.dest))
  }

  def compile = T {
    println(&quot;Compiling...&quot;)
    super.compile()
  }

  def run(args: Task[Args] = T.task(Args())) = T.command {
    println(&quot;Running...&quot; + args().value.mkString(&quot; &quot;))
    super.run(args)()
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">object foo2 extends JavaModule {
  def generatedSources = T{
    os.write(T.dest / &quot;Foo.java&quot;, &quot;&quot;&quot;...&quot;&quot;&quot;)
    Seq(PathRef(T.dest))
  }
}

object foo3 extends JavaModule {
  def sources = T{
    os.write(T.dest / &quot;Foo.java&quot;, &quot;&quot;&quot;...&quot;&quot;&quot;)
    super.sources() ++ Seq(PathRef(T.dest))
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_nesting_modules"><a class="anchor" href="#_nesting_modules"></a>Nesting Modules</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-builds-4-nested-modules.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/builds/4-nested-modules">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

trait MyModule extends JavaModule {
  def ivyDeps = Agg(
    ivy&quot;net.sourceforge.argparse4j:argparse4j:0.9.0&quot;,
    ivy&quot;org.apache.commons:commons-text:1.12.0&quot;
  )
}

object foo extends MyModule {
  def moduleDeps = Seq(bar, qux)

  object bar extends MyModule
  object qux extends MyModule {
    def moduleDeps = Seq(bar)
  }
}

object baz extends MyModule {
  def moduleDeps = Seq(foo.bar, foo.qux, foo)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publish_module"><a class="anchor" href="#_publish_module"></a>Publish Module</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-builds-6-publish-module.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/builds/6-publish-module">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._, publish._

object foo extends JavaModule with PublishModule {
  def publishVersion = &quot;0.0.1&quot;

  def pomSettings = PomSettings(
    description = &quot;Hello&quot;,
    organization = &quot;com.lihaoyi&quot;,
    url = &quot;https://github.com/lihaoyi/example&quot;,
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github(&quot;lihaoyi&quot;, &quot;example&quot;),
    developers = Seq(Developer(&quot;lihaoyi&quot;, &quot;Li Haoyi&quot;, &quot;https://github.com/lihaoyi&quot;))
  )
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example <code>JavaModule</code> with added publishing capabilities via
<code>PublishModule</code>. This requires that you define an additional
<code>publishVersion</code> and <code>pomSettings</code> with the relevant metadata, and provides
the <code>.publishLocal</code> and <code>publishSigned</code> tasks for publishing locally to the
machine or to the central maven repository</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill foo.publishLocal
Publishing Artifact(com.lihaoyi,foo,0.0.1) to ivy repo...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maven_compatible_modules"><a class="anchor" href="#_maven_compatible_modules"></a>Maven-Compatible Modules</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-builds-8-compat-modules.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/builds/8-compat-modules">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._

object foo extends MavenModule {
  object test extends MavenTests with TestModule.Junit4
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>MavenModule</code> is a variant of <code>JavaModule</code>
that uses the more verbose folder layout of Maven, SBT, and other tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foo/src/main/java</code></p>
</li>
<li>
<p><code>foo/src/test/java</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Rather than Millâs</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>foo/src</code></p>
</li>
<li>
<p><code>foo/test/src</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is especially useful if you are migrating from Maven to Mill (or vice
versa), during which a particular module may be built using both Maven and
Mill at the same time</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill foo.compile
compiling 1 Java source...

&gt; mill foo.test.compile
compiling 1 Java source...

&gt; mill foo.test.test
...foo.FooTests.hello ...

&gt; mill foo.test
...foo.FooTests.hello ...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_realistic_java_example_project"><a class="anchor" href="#_realistic_java_example_project"></a>Realistic Java Example Project</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-javalib-builds-9-realistic.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/javalib/builds/9-realistic">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._, publish._

trait MyModule extends JavaModule with PublishModule {
  def publishVersion = &quot;0.0.1&quot;

  def pomSettings = PomSettings(
    description = &quot;Hello&quot;,
    organization = &quot;com.lihaoyi&quot;,
    url = &quot;https://github.com/lihaoyi/example&quot;,
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github(&quot;lihaoyi&quot;, &quot;example&quot;),
    developers = Seq(Developer(&quot;lihaoyi&quot;, &quot;Li Haoyi&quot;, &quot;https://github.com/lihaoyi&quot;))
  )

  def ivyDeps = Agg(ivy&quot;org.apache.commons:commons-text:1.12.0&quot;)

  object test extends JavaTests with TestModule.Junit4
}

object foo extends MyModule {
  def moduleDeps = Seq(bar, qux)

  def generatedSources = T {
    os.write(
      T.dest / &quot;Version.java&quot;,
      s&quot;&quot;&quot;
package foo;
public class Version {
    public static String value() {
        return &quot;${publishVersion()}&quot;;
    }
}
      &quot;&quot;&quot;.stripMargin
    )
    Seq(PathRef(T.dest))
  }
}

object bar extends MyModule {
  def moduleDeps = Seq(qux)
}

object qux extends MyModule</code></pre>
</div>
</div>
<div class="paragraph">
<p>A semi-realistic build setup, combining all the individual Mill concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Three `JavaModule`s that depend on each other</p>
</li>
<li>
<p>With unit testing and publishing set up</p>
</li>
<li>
<p>With generated sources to include the <code>publishVersion</code> as a string in the
code, so it can be printed at runtime</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that for multi-module builds like this, using queries to run tasks on
multiple targets at once can be very convenient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>__.test
__.publishLocal</pre>
</div>
</div>
<div class="paragraph">
<p>Also note how you can use <code>trait</code>s to bundle together common combinations of
modules: <code>MyModule</code> not only defines a <code>JavaModule</code> with some common
configuration, but it also defines a <code>object test</code> module within it with its
own configuration. This is a very useful technique for managing the often
repetitive module structure in a typical project</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; mill resolve __.run
bar.run
bar.test.run
foo.run
foo.test.run
qux.run

&gt; mill foo.run
foo version 0.0.1
Foo.value: &lt;h1&gt;hello&lt;/h1&gt;
Bar.value: &lt;p&gt;world&lt;/p&gt;
Qux.value: 31337

&gt; mill bar.test
...bar.BarTests.test ...

&gt; mill qux.run
Qux.value: 31337

&gt; mill __.compile

&gt; mill __.test
...bar.BarTests.test ...
...foo.FooTests.test ...

&gt; mill __.publishLocal
Publishing Artifact(com.lihaoyi,foo,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,bar,0.0.1) to ivy repo...
Publishing Artifact(com.lihaoyi,qux,0.0.1) to ivy repo...
...

&gt; mill show foo.assembly # mac/linux
&quot;.../out/foo/assembly.dest/out.jar&quot;

&gt; ./out/foo/assembly.dest/out.jar # mac/linux
foo version 0.0.1
Foo.value: &lt;h1&gt;hello&lt;/h1&gt;
Bar.value: &lt;p&gt;world&lt;/p&gt;
Qux.value: 31337</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_builds_for_real_projects"><a class="anchor" href="#_example_builds_for_real_projects"></a>Example Builds for Real Projects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mill comes bundled with example builds for real-world open-source projects,
demonstrating how Mill can be used to build code outside of tiny example codebases:</p>
</div>
<div class="sect2">
<h3 id="_jimfs"><a class="anchor" href="#_jimfs"></a>JimFS</h3>
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-thirdparty-jimfs.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/thirdparty/jimfs">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._, publish._

def sharedCompileIvyDeps = T{
  Agg(
    ivy&quot;com.google.auto.service:auto-service:1.0.1&quot;,
    ivy&quot;com.google.code.findbugs:jsr305:3.0.2&quot;,
    ivy&quot;org.checkerframework:checker-compat-qual:2.5.5&quot;,
    ivy&quot;com.ibm.icu:icu4j:73.1&quot;,
  )
}


object jimfs extends PublishModule with MavenModule {
  def publishVersion = &quot;1.3.3.7&quot;

  def pomSettings = PomSettings(
    description = artifactName(),
    organization = &quot;com.google&quot;,
    url = &quot;https://github.com/google/jimfs&quot;,
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github(owner = &quot;google&quot;, repo = &quot;jimfs&quot;),
    developers = Nil
  )

  def ivyDeps = sharedCompileIvyDeps() ++ Agg(
    ivy&quot;com.google.guava:guava:31.1-android&quot;,
  )

  def javacOptions = Seq(&quot;-processor&quot;, &quot;com.google.auto.service.processor.AutoServiceProcessor&quot;)

  object test extends MavenTests {
    def ivyDeps = sharedCompileIvyDeps() ++ Agg(
      ivy&quot;junit:junit:4.13.2&quot;,
      ivy&quot;com.google.guava:guava-testlib:31.1-android&quot;,
      ivy&quot;com.google.truth:truth:1.1.3&quot;,
      ivy&quot;com.github.sbt:junit-interface:0.13.2&quot;,
      ivy&quot;com.ibm.icu:icu4j:73.1&quot;,
    )

    def testFramework = &quot;com.novocode.junit.JUnitFramework&quot;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JimFS is a small Java library implementing an in-memory filesystem. It is commonly
used in test suites to validate filesystem operations without needing to write
to disk.</p>
</div>
<div class="paragraph">
<p>It has a relatively simple codebase structure, a single module and test suite.
It has a number of compile-time-only dependencies shared between the library and
test suite. One wrinkle is that it uses annotation processors as part of its build,
which Mill supports by providing the relevant <code>ivyDeps</code> of the annotation processor
and providing <code>javacOptions</code> to invoke it.</p>
</div>
<div class="paragraph">
<p>Project home: <a href="https://github.com/google/jimfs" class="bare">https://github.com/google/jimfs</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill jimfs.test
Test run com.google.common.jimfs.FileTest started
Test run com.google.common.jimfs.FileTest finished: 0 failed, 0 ignored, 7 total...
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_apache_commons_io"><a class="anchor" href="#_apache_commons_io"></a>Apache Commons IO</h3>
<div class="listingblock">
<div class="title">build.mill (<a href="https://github.com/com-lihaoyi/mill/releases/download/0.12.0-M0/0.12.0-M0-example-thirdparty-commons-io.zip">download</a>, <a href="https://github.com/com-lihaoyi/mill/blob/0.12.0-M0//example/thirdparty/commons-io">browse</a>)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">package build
import mill._, javalib._, publish._
import $ivy.`com.lihaoyi::mill-contrib-jmh:$MILL_VERSION`
import contrib.jmh.JmhModule

object `package` extends RootModule with PublishModule with MavenModule {
  def publishVersion = &quot;2.17.0-SNAPSHOT&quot;

  def pomSettings = PomSettings(
    description = artifactName(),
    organization = &quot;org.apache.commons&quot;,
    url = &quot;https://github.com/apache/commons-io&quot;,
    licenses = Seq(License.`Apache-2.0`),
    versionControl = VersionControl.github(owner = &quot;apache&quot;, repo = &quot;commons-io&quot;),
    developers = Nil
  )

  object test extends MavenTests with TestModule.Junit5 with  JmhModule{
    def testSandboxWorkingDir = false
    def jmhCoreVersion = &quot;1.37&quot;
    def ivyDeps = super.ivyDeps() ++ Agg(
      ivy&quot;org.junit.jupiter:junit-jupiter:5.10.3&quot;,
      ivy&quot;org.junit-pioneer:junit-pioneer:1.9.1&quot;,
      ivy&quot;net.bytebuddy:byte-buddy:1.14.18&quot;,
      ivy&quot;net.bytebuddy:byte-buddy-agent:1.14.18&quot;,
      ivy&quot;org.mockito:mockito-inline:4.11.0&quot;,
      ivy&quot;com.google.jimfs:jimfs:1.3.0&quot;,
      ivy&quot;org.apache.commons:commons-lang3:3.14.0&quot;,
      ivy&quot;commons-codec:commons-codec:1.17.1&quot;,
      ivy&quot;org.openjdk.jmh:jmh-core:1.37&quot;,
      ivy&quot;org.openjdk.jmh:jmh-generator-annprocess:1.37&quot;,
    )
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Apache Commons IO library contains utility classes, stream implementations, file filters,
file comparators, endian transformation classes, and much more.</p>
</div>
<div class="paragraph">
<p>The core library <code>commonsio</code> is dependency-free, but the test suite <code>commonsio.test</code>
as a number of libraries included. It also ships with JMH benchmarks, which Mill
supports via the built in JMH plugin</p>
</div>
<div class="paragraph">
<p>Project home: <a href="https://github.com/apache/commons-io" class="bare">https://github.com/apache/commons-io</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mill compile
compiling 254 Java sources...
...

&gt; ./mill test.compile
compiling 261 Java sources...
...

&gt; ./mill test.testOnly org.apache.commons.io.FileUtilsTest
Test org.apache.commons.io.FileUtilsTest#testCopyFile1() started
Test org.apache.commons.io.FileUtilsTest#testCopyFile1() finished, took ...
...

&gt; ./mill test.testOnly org.apache.commons.io.FileSystemTest
Test org.apache.commons.io.FileSystemTest#testIsLegalName() started
Test org.apache.commons.io.FileSystemTest#testIsLegalName() finished, took ...
...

&gt; ./mill test.runJmh '.*PathUtilsContentEqualsBenchmark' -bm SingleShotTime
Benchmark                                                                Mode  Cnt ...
PathUtilsContentEqualsBenchmark.testCurrent_fileContentEquals              ss    5 ...
PathUtilsContentEqualsBenchmark.testCurrent_fileContentEquals_Blackhole    ss    5 ...
PathUtilsContentEqualsBenchmark.testProposal_contentEquals                 ss    5 ...
PathUtilsContentEqualsBenchmark.testProposal_contentEquals_Blackhole       ss    5 ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_real_world_mill_builds"><a class="anchor" href="#_real_world_mill_builds"></a>Real World Mill Builds</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_c3p0"><a class="anchor" href="#_c3p0"></a>C3P0</h3>
<div class="paragraph">
<p><a href="https://github.com/swaldman/c3p0">C3P0</a> is a JDBC connection pooling library
written in Java, built using the Mill build tool.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="Java_Module_Config.html">Java Module Configuration</a></span>
  <span class="next"><a href="Testing_Java_Projects.html">Testing Java Projects</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async="async" src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/lunr.js"></script>
<script src="../_/js/search-ui.js" id="search-ui-script" data-site-root-path=".." data-snippet-length="100" data-stylesheet="../_/css/search.css"></script>
<script async="async" src="../search-index.js"></script>
  
</body></html>