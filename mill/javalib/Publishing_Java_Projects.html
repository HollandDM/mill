<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Publishing Java Projects :: The Mill Build Tool</title>
    <link rel="prev" href="Linting_Java_Projects.html" />
    <link rel="next" href="Java_Web_Examples.html" />
    <meta name="generator" content="Antora 3.1.9" />
    <link rel="stylesheet" href="../../_/css/site.css" />
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-1C582ZJR85"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','G-1C582ZJR85')</script>
<link rel="icon" href="../../_/favicon.png" type="image/x-icon" />
  
  </head><body class="article">
  
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <!-- TODO: add mill icon -->
      <a class="navbar-item" href="https://mill-build.org"><img src="../../_/logo-white.svg" height="20" />Â The Mill Build Tool</a>
      <div class="navbar-item search">
        <input id="search-input" type="text" placeholder="Search the docs" />
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill">Source Code (GitHub)</a>
        <a class="navbar-item" href="https://mill-build.org/api/latest/index.html">API</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/issues">Issues</a>
        <a class="navbar-item" href="https://github.com/com-lihaoyi/mill/discussions">Discuss</a>
        <a class="navbar-item" href="https://discord.gg/MNAXQMAr">Chat</a>

            <!--
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Documentation</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#"></a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Plugins</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
        -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="mill" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
<ul class="nav-list">

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Java_Intro_to_Mill.html">Building Java Projects with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Module_Config.html">Java Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Build_Examples.html">Java Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Testing_Java_Projects.html">Testing Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Linting_Java_Projects.html">Linting Java Projects</a>
  </li>

  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="Publishing_Java_Projects.html">Publishing Java Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Java_Web_Examples.html">Java Web Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scalalib/Scala_Intro_to_Mill.html">Building Scala Projects with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/Scala_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/Scala_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/Scala_Module_Config.html">Scala Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/Scala_Build_Examples.html">Scala Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/Testing_Scala_Projects.html">Testing Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/Linting_Scala_Projects.html">Linting Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/Publishing_Scala_Projects.html">Publishing Scala Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../scalalib/Scala_Web_Examples.html">Scala Web Examples</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../kotlinlib/Kotlin_Intro_to_Mill.html">(Experimental) Kotlin with Mill</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/Kotlin_Installation_IDE_Support.html">Installation and IDE Support</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/Kotlin_Builtin_Commands.html">Built-in Commands</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/Kotlin_Module_Config.html">Kotlin Module Configuration</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/Kotlin_Build_Examples.html">Kotlin Build Examples</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/Testing_Kotlin_Projects.html">Testing Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/Linting_Kotlin_Projects.html">Linting Kotlin Projects</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../kotlinlib/Publishing_Kotlin_Projects.html">Publishing Kotlin Projects</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Build Tool Comparisons</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../comparisons/Case_Study_Mill_vs_Maven.html">Case Study: Mill vs Maven</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../comparisons/Case_Study_Mill_vs_Gradle.html">Case Study: Mill vs Gradle</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../comparisons/Case_Study_Mill_vs_SBT.html">Case Study: Mill vs SBT</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mill In Depth</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Library_Dependencies.html">Library Dependencies in Mill</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Out_Dir.html">The Output Directory</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Target_Query_Syntax.html">Target Query Syntax</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Tasks.html">Tasks</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Modules.html">Modules</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Cross_Builds.html">Cross Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Structuring_Large_Builds.html">Structuring Large Builds</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Mill_Sandboxing.html">Mill Sandboxing</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/Bundled_Libraries.html">Bundled Libraries</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../depth/The_Mill_Evaluation_Model.html">The Mill Evaluation Model</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extending Mill</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/Import_File_And_Import_Ivy.html">import $file and import $ivy</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/Using_Plugins.html">Using Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../extending/Contrib_Plugins.html">Contrib Plugins</a>
<ul class="nav-list">

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/artifactory.html">Artifactory</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/bintray.html">Bintray</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/bloop.html">Bloop</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/buildinfo.html">BuildInfo</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/codeartifact.html">Codeartifact</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/docker.html">Docker</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/errorprone.html">Mill ErrorProne Plugin</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/checkstyle.html">Checkstyle</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/flyway.html">Flyway</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/gitlab.html">Gitlab</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/jmh.html">JMH</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/playlib.html">Play Framework</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/proguard.html">Proguard</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/scalapblib.html">ScalaPB</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/scoverage.html">Scoverage</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/sonatypecentral.html">Sonatype Central</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/testng.html">TestNG</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/twirllib.html">Twirl</a>
  </li>

  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../contrib/versionfile.html">Version file</a>
  </li>
</ul>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/Thirdparty_Plugins.html">Third-Party Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/Writing_Mill_Plugins.html">Writing Mill Plugins</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../extending/The_Mill_Meta_Build.html">The Mill Meta-Build</a>
  </li>
</ul>
  </li>

  <li class="nav-item is-active" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../reference/Mill_Design_Principles.html">Mill Design Principles</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://mill-build.org/api/latest/mill/index.html">Mill Scaladoc</a>
  </li>

  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../reference/Changelog.html">reference/Changelog.adoc</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Mill Documentation</a></li>
    <li><a href="Java_Intro_to_Mill.html">Building Java Projects with Mill</a></li>
    <li><a href="Publishing_Java_Projects.html">Publishing Java Projects</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.12.0-RC2-56-612a28</button>
  <div class="version-menu">
    <a class="version is-current" href="Publishing_Java_Projects.html">0.12.0-RC2-56-612a28</a>
    <a class="version is-missing" href="../0.11.12/index.html">0.11.12</a>
    <a class="version is-missing" href="../0.11.11/index.html">0.11.11</a>
    <a class="version is-missing" href="../0.11.10/index.html">0.11.10</a>
    <a class="version is-missing" href="../0.11.0-M7/index.html">0.11.0-M7</a>
    <a class="version is-missing" href="../0.10.15/index.html">0.10.15</a>
    <a class="version is-missing" href="../0.10.12/index.html">0.10.12</a>
    <a class="version is-missing" href="../0.10.0/index.html">0.10.0</a>
    <a class="version is-missing" href="../0.9.12/index.html">0.9.12</a>
  </div>
</div>
<div class="edit-this-page"><a href="https://github.com/com-lihaoyi/mill/edit/main/docs/modules/ROOT/pages/javalib/Publishing_Java_Projects.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Publishing Java Projects</h1>
<div class="paragraph">
<p>gtag('config', 'AW-16649289906');
&lt;/script&gt;</p>
</div>
This page will discuss common topics around publishing your Java projects for others to use

== Publishing Locally

// SNIPPET:BUILD


.build.mill ({mill-download-url}/0.12.0-RC2-example-javalib-publishing-2-publish-module.zip[download], {mill-example-url}/example/javalib/publishing/2-publish-module[browse])
[source,scala,subs=&quot;attributes,verbatim&quot;]
----

package build
import mill._, javalib._, publish._

object foo extends JavaModule with PublishModule {
  def publishVersion = &quot;0.0.1&quot;

  def pomSettings = PomSettings(
    description = &quot;Hello&quot;,
    organization = &quot;com.lihaoyi&quot;,
    url = &quot;https://github.com/lihaoyi/example&quot;,
    licenses = Seq(License.MIT),
    versionControl = VersionControl.github(&quot;lihaoyi&quot;, &quot;example&quot;),
    developers = Seq(Developer(&quot;lihaoyi&quot;, &quot;Li Haoyi&quot;, &quot;https://github.com/lihaoyi&quot;))
  )
}
----

This is an example `JavaModule` with added publishing capabilities via
`PublishModule`. This requires that you define an additional
`publishVersion` and `pomSettings` with the relevant metadata, and provides
the `.publishLocal` and `publishSigned` tasks for publishing locally to the
machine or to the central maven repository


[source,bash,subs=&quot;attributes,verbatim&quot;]
----
&gt; mill foo.publishLocal
Publishing Artifact(com.lihaoyi,foo,0.0.1) to ivy repo...
----

== Publishing to Sonatype Maven Central

Once you've mixed in `PublishModule`, apart from publishing locally, you can also publish
your project's modules to maven central

=== GPG

If you've never created a keypair before that can be used to sign your artifacts
you'll need to do this. https://central.sonatype.org/publish/requirements/gpg/[Sonatype's GPG Documentation]
has the instructions on how to do this

=== Publishing Secrets

Mill uses the following environment variables as a way to pass the necessary secrets
for publishing:


[source,bash]
----
# The LHS and RHS of the User Token, accessible through the sonatype
# website `Profile` / `User Token` / `Access User Token`
export MILL_SONATYPE_USERNAME=...
export MILL_SONATYPE_PASSWORD=...

# The base-64 encoded PGP key, which can be encoded in the following way
# for each OS:
#
# MacOS or FreeBSD
# gpg --export-secret-key -a $LONG_ID | base64
#
# Ubuntu (assuming GNU base64)
# gpg --export-secret-key -a $LONG_ID | base64 -w0
#
# Arch
# gpg --export-secret-key -a $LONG_ID | base64 | sed -z 's;\n;;g'
#
# Windows
# gpg --export-secret-key -a %LONG_ID% | openssl base64
export MILL_PGP_SECRET_BASE64=...

# The passphrase associated with your PGP key
export MILL_PGP_PASSPHRASE=...
----

=== Publishing

You can publish all eligible modules in your Mill project as follows:

[source,bash]
----
mill mill.scalalib.PublishModule/
----

You can also specify individual modules you want to publish via a selector:

[source,bash]
----
mill mill.scalalib.PublishModule/ foo.publishArtifacts
----

The default URL for publishing to sonatype's Maven Central is `oss.sonatype.org`.
Newer projects registered on sonatype may need to publish using `s01.oss.sonatype.org`.
In that case, you can pass in a `--sonatypeUri`:

[source,bash]
----
mill mill.scalalib.PublishModule/ \
        --sonatypeUri https://s01.oss.sonatype.org/service/local
----

This also allows you to publish to your own internal corporate sonatype deployment,
by passing in `--sonatypeUri example.company.com` instead.

[NOTE]
--
Since Feb. 2021 any new Sonatype accounts have been created on
`s01.oss.sonatype.org`, so you'll want to ensure you set the relevant URIs to match.

The symptom of using the &quot;wrong&quot; URL for publishling is typically a 403 error code, in response to the publish request.

See https://central.sonatype.org/publish/publish-guide/#releasing-to-central

Typically

* `https://s01.oss.sonatype.org/service/local` - for the `--sonatypeUri`
* `https://s01.oss.sonatype.org/content/repositories/snapshots` - for `sonatypeSnapshotUri`

--
=== Publishing Using Github Actions


To publish on Github Actions, you can use something like this:

```yaml
# .github/workflows/publish-artifacts.yml
name: Publish Artifacts
on:
  push:
    tags:
      - '**'
  workflow_dispatch:
jobs:
  publish-artifacts:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17'
      - run: ./mill mill.scalalib.PublishModule/
        env:
          MILL_PGP_PASSPHRASE: ${{ secrets.MILL_PGP_PASSPHRASE }}
          MILL_PGP_SECRET_BASE64: ${{ secrets.MILL_PGP_SECRET_BASE64 }}
          MILL_SONATYPE_PASSWORD: ${{ secrets.MILL_SONATYPE_PASSWORD }}
          MILL_SONATYPE_USERNAME: ${{ secrets.MILL_SONATYPE_USERNAME }}
```

Where `MILL_PGP_PASSPHRASE`, `MILL_PGP_SECRET_BASE64`, `MILL_SONATYPE_PASSWORD`, and
`MILL_SONATYPE_USERNAME` configured for the repository's or organization's Github Actions
workflows. See
https://docs.github.com/en/actions/security-for-github-actions/security-guides/using-secrets-in-github-actions[Using Secrets in Github Actions]
for more details.

=== Non-Staging Releases (classic Maven uploads)

If the site does not support staging releases as `oss.sonatype.org` and `s01.oss.sonatype.org` do (for
example, a self-hosted OSS nexus site), you can pass in the
`--stagingRelease false` option to simply upload release artifacts to corresponding
maven path under `sonatypeUri` instead of staging path.

[source,bash]
----
mill mill.scalalib.PublishModule/ \
        foo.publishArtifacts \
        lihaoyi:$SONATYPE_PASSWORD \
        --sonatypeUri http://example.company.com/release \
        --stagingRelease false
----


== Publishing to other repositories

While Sonatype Maven Central is the default publish repository for JVM ecosystem projects,
there are also others that you can use. Mill supports these largely through contrib plugins:

* xref:contrib/codeartifact.adoc[]
* xref:contrib/artifactory.adoc[]
* xref:contrib/bintray.adoc[]
* xref:contrib/sonatypecentral.adoc[]
<nav class="pagination">
  <span class="prev"><a href="Linting_Java_Projects.html">Linting Java Projects</a></span>
  <span class="next"><a href="Java_Web_Examples.html">Java Web Examples</a></span>
</nav>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async="async" src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async="async" src="../../search-index.js"></script>
  
</body></html>